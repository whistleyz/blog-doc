<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.jpg" />
    <link rel="stylesheet" href="/umi.79bb87e3.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.3.3
    </script>
    <title>Vue 编译</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/principle/vue_compile" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.jpg&#x27;)" href="/">blog-doc</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a href="/summary">Summary</a></span><span><a href="/practice">Practice</a></span><span><a aria-current="page" class="active" href="/principle">Principle</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/whistleyz">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.jpg&#x27;)" href="/"></a><h1>blog-doc</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a href="/summary">Summary</a></li><li><a href="/practice">Practice</a></li><li><a aria-current="page" class="active" href="/principle">Principle</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/whistleyz">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">Front</a><ul><li><a href="/principle/reactive_vue"><span>深入了解 vue 响应式原理</span></a></li><li><a href="/principle/state_manager"><span>实现一个前端状态管理器</span></a></li><li><a href="/principle/vue_computed"><span>Vue computed 与记忆函数</span></a></li></ul></li><li><a target="_blank" rel="noopener noreferrer">ECMAScript</a><ul><li><a href="/principle/promise"><span>Promise 规范与实现</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="编译流程" data-depth="2"><a href="/principle/vue_compile#编译流程"><span>编译流程</span></a></li><li title="AST 语法树的生成" data-depth="3"><a href="/principle/vue_compile#ast-语法树的生成"><span>AST 语法树的生成</span></a></li><li title="AST 优化" data-depth="3"><a href="/principle/vue_compile#ast-优化"><span>AST 优化</span></a></li><li title="代码生成" data-depth="3"><a href="/principle/vue_compile#代码生成"><span>代码生成</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="vue-编译"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#vue-编译"><span class="icon,icon-link"></span></a>Vue 编译</h1><h2 id="编译流程"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#编译流程"><span class="icon,icon-link"></span></a>编译流程</h2><div class="__dumi-default-code-block"><pre class="prism-code language-html"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag"> </span><span class="token tag attr-name">id</span><span class="token tag attr-value punctuation">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">app</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  {{userName}}</span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript"></span><span class="token script language-javascript keyword">new</span><span class="token script language-javascript"> </span><span class="token script language-javascript class-name">Vue</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  el</span><span class="token script language-javascript punctuation">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string">&#x27;#app&#x27;</span><span class="token script language-javascript punctuation">,</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  data</span><span class="token script language-javascript punctuation">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript"> f</span><span class="token script language-javascript punctuation">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string">&#x27;y&#x27;</span><span class="token script language-javascript punctuation">,</span><span class="token script language-javascript"> l</span><span class="token script language-javascript punctuation">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript string">&#x27;z&#x27;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">}</span><span class="token script language-javascript punctuation">,</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  computed</span><span class="token script language-javascript punctuation">:</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">    </span><span class="token script language-javascript function">userName</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword">return</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword">this</span><span class="token script language-javascript punctuation">.</span><span class="token script language-javascript property-access">f</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator">+</span><span class="token script language-javascript"> </span><span class="token script language-javascript keyword">this</span><span class="token script language-javascript punctuation">.</span><span class="token script language-javascript property-access">l</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation">}</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation">}</span><span class="token script language-javascript punctuation">,</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  </span><span class="token script language-javascript function">mounted</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">    </span><span class="token script language-javascript function">setTimeout</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript punctuation">(</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript"> </span><span class="token script language-javascript arrow operator">=&gt;</span><span class="token script language-javascript"> </span><span class="token script language-javascript punctuation">{</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">      </span><span class="token script language-javascript keyword">this</span><span class="token script language-javascript punctuation">.</span><span class="token script language-javascript property-access">f</span><span class="token script language-javascript"> </span><span class="token script language-javascript operator">=</span><span class="token script language-javascript"> </span><span class="token script language-javascript string">&#x27;x&#x27;</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">    </span><span class="token script language-javascript punctuation">}</span><span class="token script language-javascript punctuation">,</span><span class="token script language-javascript"> </span><span class="token script language-javascript number">1000</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript">  </span><span class="token script language-javascript punctuation">}</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript"></span><span class="token script language-javascript punctuation">}</span><span class="token script language-javascript punctuation">)</span><span class="token script language-javascript"></span></div><div class="token-line"><span class="token script language-javascript"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">script</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>编译流程：</p><ol><li>生成 ast 语法树</li><li>优化 ast 语法树</li><li>ast 语法树生成 render 函数</li></ol><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token doc-comment comment">/**</span></div><div class="token-line"><span class="token doc-comment comment"> *	template = `&lt;div id=&quot;app&quot;&gt;</span></div><div class="token-line"><span class="token doc-comment comment"> *    </span><span class="token doc-comment comment punctuation">{</span><span class="token doc-comment comment punctuation">{</span><span class="token doc-comment comment">userName</span><span class="token doc-comment comment punctuation">}</span><span class="token doc-comment comment punctuation">}</span><span class="token doc-comment comment"></span></div><div class="token-line"><span class="token doc-comment comment"> *  &lt;/div&gt;`</span></div><div class="token-line"><span class="token doc-comment comment"> */</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">compileToFunctions</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">template</span><span class="token parameter punctuation">,</span><span class="token parameter"> options</span><span class="token parameter punctuation">,</span><span class="token parameter"> vm</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">compile</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">template</span><span class="token parameter punctuation">,</span><span class="token parameter"> options</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">const</span><span class="token plain"> ast </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token plain">template</span><span class="token punctuation">,</span><span class="token plain"> options</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token function">optimize</span><span class="token punctuation">(</span><span class="token plain">ast</span><span class="token punctuation">,</span><span class="token plain"> options</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> code </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token plain">ast</span><span class="token punctuation">,</span><span class="token plain"> options</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    ast</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    render</span><span class="token punctuation">:</span><span class="token plain"> code</span><span class="token punctuation">.</span><span class="token property-access">render</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    staticRenderFns</span><span class="token punctuation">:</span><span class="token plain"> code</span><span class="token punctuation">.</span><span class="token property-access">staticRenderFns</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-json"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// ast</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">const code = </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;attrsList&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;attrsMap&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;class&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;list-group&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;v-if&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;articles&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;rawAttrsMap&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;class&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;list-group&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">4</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">22</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token property">&quot;v-if&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;v-if&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;articles&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">23</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">38</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;children&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;tag&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;attrsList&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;attrsMap&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token property">&quot;v-for&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;item in articles&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token property">&quot;:key&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token property">&quot;class&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;list-group-item&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;rawAttrsMap&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token property">&quot;v-for&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;v-for&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;item in articles&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">50</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">74</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token property">&quot;:key&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;:key&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">75</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">86</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token property">&quot;class&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;class&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;list-group-item&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">87</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">110</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;parent&quot;</span><span class="token operator">:</span><span class="token plain"> code</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token comment">// 引用 ul ast</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;children&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;expression&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;\&quot;\\n        \&quot;+_s(item)+\&quot;\\n      \&quot;&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;tokens&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token string">&quot;\n        &quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token property">&quot;@binding&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;item&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token string">&quot;\n      &quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;text&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;\n        {{item}}\n      &quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">111</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">135</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token property">&quot;static&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">46</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">140</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;for&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;articles&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;alias&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;key&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;plain&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;staticClass&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;\&quot;list-group-item\&quot;&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;static&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;staticRoot&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;forProcessed&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;start&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;end&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token number">150</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;if&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;articles&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;ifConditions&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;exp&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;articles&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token property">&quot;block&quot;</span><span class="token operator">:</span><span class="token plain"> code </span><span class="token comment">// 引用 ul ast</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;plain&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;staticClass&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;\&quot;list-group\&quot;&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;static&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;staticRoot&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token property">&quot;ifProcessed&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">code </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  render</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">with(this){return _c(&#x27;div&#x27;,{attrs:{&quot;id&quot;:&quot;app&quot;}},[_v(_s(userName))])}</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  staticRenderFns</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="ast-语法树的生成"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#ast-语法树的生成"><span class="icon,icon-link"></span></a>AST 语法树的生成</h3><h4 id="parsehtml"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#parsehtml"><span class="icon,icon-link"></span></a>parseHTML</h4><ol><li><p>handleStartTag(&#x27;ul&#x27;) -&gt; options.start(el) -&gt; stack.push(el)</p></li><li><p>handleStartTag(&#x27;li&#x27;) -&gt; options.start(el) -&gt; stack.push(el)</p></li><li><p>options.chars(text) 处理 li.innerHTML</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token doc-comment comment">/**</span></div><div class="token-line"><span class="token doc-comment comment">cosnt res = parseText(&#x27;  </span><span class="token doc-comment comment punctuation">{</span><span class="token doc-comment comment punctuation">{</span><span class="token doc-comment comment">item</span><span class="token doc-comment comment punctuation">}</span><span class="token doc-comment comment punctuation">}</span><span class="token doc-comment comment">\n&#x27;)</span></div><div class="token-line"><span class="token doc-comment comment">res为：</span></div><div class="token-line"><span class="token doc-comment comment"></span><span class="token doc-comment comment punctuation">{</span><span class="token doc-comment comment"></span></div><div class="token-line"><span class="token doc-comment comment">	expression: &quot;\n        &quot;+_s(item)+&quot;\n      &quot;,</span></div><div class="token-line"><span class="token doc-comment comment">	tokens: [&#x27;\n    &#x27;, </span><span class="token doc-comment comment punctuation">{</span><span class="token doc-comment comment">&#x27;@binding&#x27;: &#x27;item&#x27;</span><span class="token doc-comment comment punctuation">}</span><span class="token doc-comment comment">, &#x27;\n    &#x27;]</span></div><div class="token-line"><span class="token doc-comment comment"></span><span class="token doc-comment comment punctuation">}</span><span class="token doc-comment comment"></span></div><div class="token-line"><span class="token doc-comment comment">   	</span></div><div class="token-line"><span class="token doc-comment comment">**/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> child </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  type</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">2</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  expression</span><span class="token punctuation">:</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token property-access">expression</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	end</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">135</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	start</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">111</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	text</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	tokens</span><span class="token punctuation">:</span><span class="token plain"> res</span><span class="token punctuation">.</span><span class="token property-access">tokens</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">li</span><span class="token punctuation">.</span><span class="token property-access">children</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token plain">child</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>parseEndTag(&#x27;li&#x27;) -&gt; options.end(el) -&gt; stack.length -= 1 -&gt; closeElement(el)</p></li><li><p>parseEndTag(&#x27;ul&#x27;) -&gt; options.end(el) -&gt; stack.length -= 1 -&gt; closeElement(el)</p></li><li><p>return root</p></li></ol><p><strong>closeElement</strong></p><ol><li><p>processKey(element)</p></li><li><p>processRef(element)</p></li><li><p>processSlotContent(element)</p></li><li><p>proccessSlotOutlet(element)</p></li><li><p>processComponent(element)</p></li><li><p>Transform hooks</p></li><li><p>processAttrs(element)</p></li><li><p>完成 html -&gt; tag, attr 的解析 createASTElement(tag, attrs, currentParent)</p></li><li><p>processFor(element)</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">var</span><span class="token plain"> exp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAndRemoveAttr</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;v-for&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">extend</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token function">parseFor</span><span class="token punctuation">(</span><span class="token plain">exp</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>processIf(element)</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">const</span><span class="token plain"> ifExp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAndRemoveAttr</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;v-if&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">ifExp</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"> 	el</span><span class="token punctuation">.</span><span class="token property-access">if</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> ifExp</span></div><div class="token-line"><span class="token plain">	el</span><span class="token punctuation">.</span><span class="token property-access">ifConditions</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> block</span><span class="token punctuation">:</span><span class="token plain"> el</span><span class="token punctuation">,</span><span class="token plain"> exp</span><span class="token punctuation">:</span><span class="token plain"> ifExp </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">	</span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token function">getAndRemoveAttr</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;v-else&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    v</span><span class="token punctuation">.</span><span class="token property-access">else</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">var</span><span class="token plain"> elseIfExp </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAndRemoveAttr</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;v-else&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">elseifExp</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    el</span><span class="token punctuation">.</span><span class="token property-access">elseif</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> elseifExp</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li><li><p>processOnce(element)</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">once </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">getAndRemoveAttr</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token string">&#x27;v-once&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">once </span><span class="token operator">!==</span><span class="token plain"> </span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  el</span><span class="token punctuation">.</span><span class="token property-access">once</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></li></ol><h3 id="ast-优化"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#ast-优化"><span class="icon,icon-link"></span></a>AST 优化</h3><blockquote><p>Goal of the optimizer: walk the generated template AST tree</p><p>and detect sub-trees that are purely static, i.e. parts of</p><p>the DOM that never needs to change.</p><p>Once we detect these sub-trees, we can:</p><ol><li><p>Hoist them into constants, so that we no longer need to  create fresh nodes for them on each re-render;</p></li><li><p>Completely skip them in the patching process.</p></li></ol></blockquote><p>递归 markStatic(node) ，如果是静态节点，那么 node.static = true</p><p>isStatic (node) 判断逻辑</p><ul><li>node.type == 3 // text</li><li>node.pre</li><li>!node.hasBindings // no dynamic binding</li><li>!node.if &amp;&amp; !node.for // not v-if or v-foror v-else</li></ul><h3 id="代码生成"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#代码生成"><span class="icon,icon-link"></span></a>代码生成</h3><h4 id="genelement"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#genelement"><span class="icon,icon-link"></span></a>genElement</h4><p>genStatic genOnce genFor genIf genChildren genSlot genComponent genData genChildren</p><h5 id="genif"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#genif"><span class="icon,icon-link"></span></a>genIF</h5><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">genIfConditions</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token parameter">conditions</span><span class="token parameter punctuation">,</span><span class="token parameter"></span></div><div class="token-line"><span class="token parameter">    state</span><span class="token parameter punctuation">,</span><span class="token parameter"></span></div><div class="token-line"><span class="token parameter">    altGen</span><span class="token parameter punctuation">,</span><span class="token parameter"></span></div><div class="token-line"><span class="token parameter">    altEmpty</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token plain">conditions</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> altEmpty </span><span class="token operator">||</span><span class="token plain"> </span><span class="token string">&#x27;_e()&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">var</span><span class="token plain"> condition </span><span class="token operator">=</span><span class="token plain"> conditions</span><span class="token punctuation">.</span><span class="token method function property-access">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">condition</span><span class="token punctuation">.</span><span class="token property-access">exp</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token string">&quot;(&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">condition</span><span class="token punctuation">.</span><span class="token property-access">exp</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&quot;)?&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token function">genTernaryExp</span><span class="token punctuation">(</span><span class="token plain">condition</span><span class="token punctuation">.</span><span class="token property-access">block</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&quot;:&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token function">genIfConditions</span><span class="token punctuation">(</span><span class="token plain">conditions</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">,</span><span class="token plain"> altGen</span><span class="token punctuation">,</span><span class="token plain"> altEmpty</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token function">genTernaryExp</span><span class="token punctuation">(</span><span class="token plain">condition</span><span class="token punctuation">.</span><span class="token property-access">block</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// v-if with v-once should generate code like (a)?_m(0):_m(1)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">genTernaryExp</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> altGen</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">?</span><span class="token plain"> </span><span class="token function">altGen</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">:</span><span class="token plain"> el</span><span class="token punctuation">.</span><span class="token property-access">once</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token operator">?</span><span class="token plain"> </span><span class="token function">genOnce</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">genElement</span><span class="token punctuation">(</span><span class="token plain">el</span><span class="token punctuation">,</span><span class="token plain"> state</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h5 id="gendata"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#gendata"><span class="icon,icon-link"></span></a>genData</h5><h5 id="genelement-1"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#genelement-1"><span class="icon,icon-link"></span></a>genElement</h5><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// &quot;_c(&#x27;li&#x27;,{key:item,staticClass:&quot;list-group-item&quot;},[_v(&quot;\n        &quot;+_s(item)+&quot;\n      &quot;)])&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// &quot;_c(&#x27;ul&#x27;,{staticClass:&quot;list-group&quot;},_l((articles),function(item){return _c(&#x27;li&#x27;,{key:item,staticClass:&quot;list-group-item&quot;},[_v(&quot;\n        &quot;+_s(item)+&quot;\n      &quot;)])}),0)&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// &quot;(articles)?_c(&#x27;ul&#x27;,{staticClass:&quot;list-group&quot;},_l((articles),function(item){return _c(&#x27;li&#x27;,{key:item,staticClass:&quot;list-group-item&quot;},[_v(&quot;\n        &quot;+_s(item)+&quot;\n      &quot;)])}),0):_e()&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> render </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token string">&quot;with(this){return &quot;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> code </span><span class="token operator">+</span><span class="token plain"> </span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h4 id="createfunction"><a aria-hidden="true" tabindex="-1" href="/principle/vue_compile#createfunction"><span class="icon,icon-link"></span></a>createFunction</h4><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">res</span><span class="token punctuation">.</span><span class="token property-access">render</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">createFunction</span><span class="token punctuation">(</span><span class="token plain">compiled</span><span class="token punctuation">.</span><span class="token property-access">render</span><span class="token punctuation">,</span><span class="token plain"> fnGenErrors</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">createFunction</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">code</span><span class="token parameter punctuation">,</span><span class="token parameter"> errors</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">try</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token plain">code</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">catch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    errors</span><span class="token punctuation">.</span><span class="token method function property-access">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> err</span><span class="token punctuation">:</span><span class="token plain"> err</span><span class="token punctuation">,</span><span class="token plain"> code</span><span class="token punctuation">:</span><span class="token plain"> code </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> noop</span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">cache</span><span class="token punctuation">[</span><span class="token plain">key</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> res</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// render 挂载到 $options.render = render</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 在最终的 Vue.prototype._render 方法中调用</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// render.call(vm._renderProxy, vm.$createElement)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last update: ">2020-8-24 19:54:34</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="https://hm.baidu.com/hm.js?56fbe606b14d07f8ad321f2c766e4d29"></script>
    <script src="/umi.af893a71.js"></script>
  </body>
</html>
