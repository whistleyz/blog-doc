<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.jpg" />
    <link rel="stylesheet" href="/umi.79bb87e3.css" />
    <script>
      window.routerBase = "/";
    </script>
    <script>
      //! umi version: 3.3.3
    </script>
    <title>小程序单元测试环境搭建</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/summary/unit_test_miniapp" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.jpg&#x27;)" href="/">blog-doc</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span><a aria-current="page" class="active" href="/summary">Summary</a></span><span><a href="/practice">Practice</a></span><span><a href="/principle">Principle</a></span><span><a target="_blank" rel="noopener noreferrer" href="https://github.com/whistleyz">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></span></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.jpg&#x27;)" href="/"></a><h1>blog-doc</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li><a aria-current="page" class="active" href="/summary">Summary</a></li><li><a href="/practice">Practice</a></li><li><a href="/principle">Principle</a></li><li><a target="_blank" rel="noopener noreferrer" href="https://github.com/whistleyz">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><ul class="__dumi-default-menu-list"><li><a target="_blank" rel="noopener noreferrer">总结</a><ul><li><a href="/summary/extend_between_es6_and_es5"><span>ES6与ES5的类继承机制</span></a></li><li><a aria-current="page" class="active" href="/summary/unit_test_miniapp"><span>小程序单元测试环境搭建</span></a></li><li><a href="/summary/mvp"><span>我在前端项目中使用了 MVP</span></a></li><li><a href="/summary/bench_nodejs"><span>nodejs压力测试</span></a></li><li><a href="/summary/dynamic_form"><span>动态表单/表格</span></a></li><li><a href="/summary/sri"><span>Subresource Integrity</span></a></li></ul></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="前提" data-depth="2"><a href="/summary/unit_test_miniapp#前提"><span>前提</span></a></li><li title="MVC 的架构" data-depth="3"><a href="/summary/unit_test_miniapp#mvc-的架构"><span>MVC 的架构</span></a></li><li title="模拟小程序的接口" data-depth="3"><a href="/summary/unit_test_miniapp#模拟小程序的接口"><span>模拟小程序的接口</span></a></li><li title="搭建" data-depth="2"><a href="/summary/unit_test_miniapp#搭建"><span>搭建</span></a></li><li title="安装测试工具" data-depth="3"><a href="/summary/unit_test_miniapp#安装测试工具"><span>安装测试工具</span></a></li><li title="模拟小程序环境" data-depth="3"><a href="/summary/unit_test_miniapp#模拟小程序环境"><span>模拟小程序环境</span></a></li><li title="使用 babel 转译代码" data-depth="3"><a href="/summary/unit_test_miniapp#使用-babel-转译代码"><span>使用 babel 转译代码</span></a></li><li title="导出测试覆盖率" data-depth="3"><a href="/summary/unit_test_miniapp#导出测试覆盖率"><span>导出测试覆盖率</span></a></li><li title="示例" data-depth="2"><a href="/summary/unit_test_miniapp#示例"><span>示例</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><blockquote><p>维基百科：通常来说，程序员每修改一次程序就会进行最少一次单元测试，在编写程序的过程中前后很可能要进行多次单元测试，以证实程序达到软件规格书要求的工作目标，没有程序错误.......</p></blockquote><p>其实看到这句话，我是懵逼的。不知道大家什么情况，在我所经历的前端项目中，基本没有什么单元测试，大多情况下也就那么一说，像是在坚守程序员的底线一样。</p><p>单元测试毕竟有存在的意义，很多人不理解，微信小程序的开发文档中甚至都没怎么提及单元测试。这些人也不会理解测试人员存在的意义，测试软件的可用性是基本操作，而更重要的是保证软件的健壮性、甚至促进研发成长，比如通过推动单元测试、持续集成等手段。</p><p>收...</p><p>既然单元测试很有意义，那么我们如何来对小程序进行单元测试呢？</p><h2 id="前提"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#前提"><span class="icon,icon-link"></span></a>前提</h2><p>首先说明的是，我们仅对代码逻辑作是做单元测试，而不进行 UI 自动化测试。</p><h3 id="mvc-的架构"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#mvc-的架构"><span class="icon,icon-link"></span></a>MVC 的架构</h3><p>假设你的项目有一定的复杂度，需要接入单元测试，尽管小程序作为 MVVM 框架，但是作为 GUI 编程，一个 MVC 的架构是非常必要的，至少你的业务逻辑大部分应该抽离到类似于 MVC 的 <code>Controller</code> 中。</p><p>比如我们的小程序采用 MVP 架构：</p><p><img src="/static/mvp.8ff77fd6.png" alt="mvp"/></p><blockquote><p><a target="_blank" rel="noopener noreferrer" href="https://draveness.me/mvx">浅谈 MVC、MVP 和 MVVM 架构模式<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote><p>presenter 类似于 MVC 中的 controller，代码逻辑都放在这里，所以我们就只需要对 presenter 进行单元测试即可</p><h3 id="模拟小程序的接口"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#模拟小程序的接口"><span class="icon,icon-link"></span></a>模拟小程序的接口</h3><p>小程序大量的接口都挂载在全局变量 <code>wx</code> 下，比如我们在 nodejs 中跑逻辑的话，不可避免的要模拟这些 api。</p><h2 id="搭建"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#搭建"><span class="icon,icon-link"></span></a>搭建</h2><h3 id="安装测试工具"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#安装测试工具"><span class="icon,icon-link"></span></a>安装测试工具</h3><p><strong>安装单元测试框架mocha</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">npm i -D mocha</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>添加 mocha 配置文件：mocha.opts</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">tests/**/*.test.js</span></div><div class="token-line"><span class="token plain">--require @babel/register</span></div><div class="token-line"><span class="token plain">--reporter=list</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>执行命令：</p><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">mocha -w --opts ./mocha.opts</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>-w, --watch 监听文件改变自动执行，更多使用方法见<a target="_blank" rel="noopener noreferrer" href="https://mochajs.org/">官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><p><strong>安装断言库 chai</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i -D chai</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="模拟小程序环境"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#模拟小程序环境"><span class="icon,icon-link"></span></a>模拟小程序环境</h3><p>这里需要用到小程序的开源工具 <a target="_blank" rel="noopener noreferrer" href="https://github.com/wechat-miniprogram/miniprogram-simulate">miniprogram-simulate<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 模拟大部分的 wxapi</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">npm i -D miniprogram-simulate</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><blockquote><p>注：miniprogram-simulate 仅仅是 mock 了函数，并不是真正实现，比如：wx.request 只是返回了 ok，而并没有真正发起请求</p></blockquote><p><strong>模拟 dom 环境</strong></p><p>这个工具比较坑的一点是在 mock 部分存储函数的时候：</p><p><img src="/static/code-1.7421a164.png" alt="code"/></p><p>直接使用了 localStorage 来代替，显然 nodejs 环境下没有这些东西，需要在 nodejs 中模拟 dom 环境：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">npm i -D jsdom jsdom-global</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h3 id="使用-babel-转译代码"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#使用-babel-转译代码"><span class="icon,icon-link"></span></a>使用 babel 转译代码</h3><p>nodejs 并不支持 import 语法，以及部分比较新的 es6+ 语法。</p><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i -D @babel/core @babel/register</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>在执行 mocha 命令的时候加上 <code>--require @babel/register</code>可以在根目录下添加 <code>.babelrc</code> 文件自定义配置</p><h3 id="导出测试覆盖率"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#导出测试覆盖率"><span class="icon,icon-link"></span></a>导出测试覆盖率</h3><p><strong>安装工具 nyc</strong></p><div class="__dumi-default-code-block"><pre class="prism-code language-shell"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token function">npm</span><span class="token plain"> i -D nyc</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>查看覆盖率：</p><p><code>nyc mocha --opts ./mocha.opts</code></p><p>导出覆盖率 html 文件到 ./coverage 文件夹：</p><p><code>nyc --reporter=html --report-dir ./coverage --reporter=text mocha --opts ./mocha.opts</code></p><h2 id="示例"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#示例"><span class="icon,icon-link"></span></a>示例</h2><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token comment">// adapter</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;miniprogram-simulate&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> querystring </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;querystring&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> request </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;request&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#x27;jsdom-global&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword nil">undefined</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  storageQuota</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">10000000</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  url</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token string">&#x27;http://localhost:80&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 修正全局 localStorage</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">global</span><span class="token punctuation">.</span><span class="token property-access">localStorage</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">localStorage</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// 模拟 request</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">wx</span><span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">request</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">obj</span><span class="token punctuation">.</span><span class="token property-access">method</span><span class="token plain"> </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;GET&#x27;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    obj</span><span class="token punctuation">.</span><span class="token property-access">url</span><span class="token plain"> </span><span class="token operator">+=</span><span class="token plain"> </span><span class="token string">&#x27;?&#x27;</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> querystring</span><span class="token punctuation">.</span><span class="token method function property-access">stringify</span><span class="token punctuation">(</span><span class="token plain">obj</span><span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">request</span><span class="token punctuation">(</span><span class="token plain">obj</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token parameter punctuation">,</span><span class="token parameter"> res</span><span class="token parameter punctuation">,</span><span class="token parameter"> body</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      obj</span><span class="token punctuation">.</span><span class="token method function property-access">fail</span><span class="token punctuation">(</span><span class="token plain">err</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">else</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      obj</span><span class="token punctuation">.</span><span class="token method function property-access">success</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> data</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token known-class-name class-name">JSON</span><span class="token punctuation">.</span><span class="token method function property-access">parse</span><span class="token punctuation">(</span><span class="token plain">body</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>编写单元测试代码：</p><div class="__dumi-default-code-block"><pre class="prism-code language-js"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token keyword module">import</span><span class="token plain"> </span><span class="token string">&#x27;./adapter&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> expect</span><span class="token punctuation">,</span><span class="token plain"> assert </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;chai&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token maybe-class-name">DrivingRoutePlanEntity</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword module">from</span><span class="token plain"> </span><span class="token string">&#x27;../plugin/entitys/DrivingRoutePlanEntity&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#x27;Model: DrivingRoutePlan&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> queryOptions </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token string">&quot;from&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;39.984210069444444,116.30732204861111&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;to&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;39.957849,116.291090&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> model </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">new</span><span class="token plain"> </span><span class="token class-name">DrivingRoutePlanModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// describe 的第二个参数不能为异步函数</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#x27;should request success&#x27;</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token keyword">async</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> result </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword">await</span><span class="token plain"> model</span><span class="token punctuation">.</span><span class="token method function property-access">driving</span><span class="token punctuation">(</span><span class="token plain">queryOptions</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">result</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token property-access">be</span><span class="token punctuation">.</span><span class="token method function property-access">an</span><span class="token punctuation">(</span><span class="token string">&#x27;array&#x27;</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    result</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token function">expect</span><span class="token punctuation">(</span><span class="token plain">item</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token property-access">to</span><span class="token punctuation">.</span><span class="token property-access">be</span><span class="token punctuation">.</span><span class="token property-access">an</span><span class="token punctuation">.</span><span class="token method function property-access">instanceof</span><span class="token punctuation">(</span><span class="token maybe-class-name">DrivingRoutePlanEntity</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span></div></pre></div><p>命令示例：</p><div class="__dumi-default-code-block"><pre class="prism-code language-unknown"><button class="__dumi-default-icon __dumi-default-code-block-copy-btn" data-status="ready"></button><div class="token-line"><span class="token plain">&quot;scripts&quot;: {</span></div><div class="token-line"><span class="token plain">    &quot;test&quot;: &quot;mocha -w --opts ./mocha.opts&quot;,</span></div><div class="token-line"><span class="token plain">    &quot;coverage&quot;: &quot;nyc mocha --opts ./mocha.opts&quot;,</span></div><div class="token-line"><span class="token plain">    &quot;coverage:html&quot;: &quot;nyc --reporter=html --report-dir ./coverage --reporter=text mocha --opts ./mocha.opts&quot;</span></div><div class="token-line"><span class="token plain">  },</span></div><div class="token-line"><span class="token plain"></span></div></pre></div><h1 id="end"><a aria-hidden="true" tabindex="-1" href="/summary/unit_test_miniapp#end"><span class="icon,icon-link"></span></a>End</h1><p>祝大家搬砖愉快...</p></div><div class="__dumi-default-layout-footer-meta"><span data-updated-text="Last update: ">2020-6-18 20:11:40</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script src="https://hm.baidu.com/hm.js?56fbe606b14d07f8ad321f2c766e4d29"></script>
    <script src="/umi.af893a71.js"></script>
  </body>
</html>
